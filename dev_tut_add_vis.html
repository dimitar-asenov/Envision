<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>Envision: Adding a new visualization item</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Envision
   </div>
   <div id="projectbrief">A visual programming IDE for object-oriented languages</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dev_tutorials.html">Tutorials for Envision contributors</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Adding a new visualization item </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>In this tutorial we will see how to add a custom visualization for a node.</p>
<p>We will create a visualization for if statement nodes. We showed how to create this node type in <a class="el" href="dev_tut_add_node.html">Adding a new node type to Envision's model</a> . You should be familiar with that tutorial before reading on. In the present tutorial we will use <a class="el" href="classOOVisualization_1_1VIfStatement.html">OOVisualization::VIfStatement</a> as example.</p>
<h1><a class="anchor" id="intro"></a>
Introduction</h1>
<p>Visual objects in Envision are called items. The name comes from the super type of all visualizations which is <a class="el" href="classVisualization_1_1Item.html">Visualization::Item</a> (which in turn inherits from Qt's QGraphicsItem).</p>
<p>To draw something on the scene (Envision's visual canvas), an item can do any combination of the following:</p><ul>
<li>Draw directly on the scene, by using Qt's QPainter drawing methods.</li>
<li>Contain child items which themselves may draw something.</li>
</ul>
<p>Envision already provides many useful items that directly draw on the scene. Typically these are used as leaves in a more complicated rendering tree. Most newly created visualizations therefore are only concerned with defining what child items they contain and how they should be arranged on the screen. Our example, <a class="el" href="classOOVisualization_1_1VIfStatement.html">OOVisualization::VIfStatement</a>, also does not draw anything itself. Instead it creates a number of child items and arranges them using a layout.</p>
<p>The easiest way to arrange child items is to use the services of <a class="el" href="classVisualization_1_1DeclarativeItem.html" title="The DeclarativeItem class is the base class for all items that use the declarative API for visualizat...">Visualization::DeclarativeItem</a>. Items inheriting from it have at their disposal a powerful and fast layout manager inspired by GUI frameworks. For detailed information on this declarative framework please see <a href="http://www.pm.inf.ethz.ch/content/dam/ethz/special-interest/infk/chair-program-method/pm/documents/Education/Theses/Andrea_Helfenstein_BA_report.pdf">Andrea Helfenstein's Bachelor Thesis Report</a>. Below we will only cover parts of it that are relevant for our example.</p>
<h1><a class="anchor" id="vif_header"></a>
VIfStatement.h</h1>
<p>Here is <code>VIfStatement.h</code> : </p><div class="fragment"><div class="line"><span class="comment">/***********************************************************************************************************************</span></div>
<div class="line"><span class="comment">**</span></div>
<div class="line"><span class="comment">** Copyright (c) 2011, 2014 ETH Zurich</span></div>
<div class="line"><span class="comment">** All rights reserved.</span></div>
<div class="line"><span class="comment">**</span></div>
<div class="line"><span class="comment">** Redistribution and use in source and binary forms, with or without modification, are permitted provided that the</span></div>
<div class="line"><span class="comment">** following conditions are met:</span></div>
<div class="line"><span class="comment">**</span></div>
<div class="line"><span class="comment">**    * Redistributions of source code must retain the above copyright notice, this list of conditions and the following</span></div>
<div class="line"><span class="comment">**      disclaimer.</span></div>
<div class="line"><span class="comment">**    * Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the</span></div>
<div class="line"><span class="comment">**      following disclaimer in the documentation and/or other materials provided with the distribution.</span></div>
<div class="line"><span class="comment">**    * Neither the name of the ETH Zurich nor the names of its contributors may be used to endorse or promote products</span></div>
<div class="line"><span class="comment">**      derived from this software without specific prior written permission.</span></div>
<div class="line"><span class="comment">**</span></div>
<div class="line"><span class="comment">**</span></div>
<div class="line"><span class="comment">** THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES,</span></div>
<div class="line"><span class="comment">** INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</span></div>
<div class="line"><span class="comment">** DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span></div>
<div class="line"><span class="comment">** SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR</span></div>
<div class="line"><span class="comment">** SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,</span></div>
<div class="line"><span class="comment">** WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span></div>
<div class="line"><span class="comment">** OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span></div>
<div class="line"><span class="comment">**</span></div>
<div class="line"><span class="comment">***********************************************************************************************************************/</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#pragma once</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;../oovisualization_api.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;VIfStatementStyle.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;VStatementItem.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;OOModel/src/statements/IfStatement.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;VisualizationBase/src/items/ItemWithNode.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;VisualizationBase/src/declarative/DeclarativeItem.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceVisualization.html">Visualization</a> {</div>
<div class="line">   <span class="keyword">class </span>SequentialLayout;</div>
<div class="line">   <span class="keyword">class </span>Static;</div>
<div class="line">   <span class="keyword">class </span>NodeWrapper;</div>
<div class="line">   <span class="keyword">class </span>Line;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceOOVisualization.html">OOVisualization</a> {</div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>VStatementItemList;</div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>OOVISUALIZATION_API VIfStatement</div>
<div class="line">   : <span class="keyword">public</span> <a class="code" href="classCore_1_1Reflect.html">Super</a>&lt;VStatementItem&lt;VIfStatement, Visualization::DeclarativeItem&lt;VIfStatement&gt;,</div>
<div class="line">     OOModel::IfStatement&gt;&gt;</div>
<div class="line">{</div>
<div class="line">   ITEM_COMMON(VIfStatement)</div>
<div class="line"></div>
<div class="line">   public:</div>
<div class="line">      VIfStatement(Item* parent, NodeType* node, const StyleType* style = itemStyles().get());</div>
<div class="line"></div>
<div class="line">      <a class="code" href="namespaceVisualization.html">Visualization</a>::NodeWrapper* condition() const;</div>
<div class="line">      VStatementItemList* thenBranch() const;</div>
<div class="line">      VStatementItemList* elseBranch() const;</div>
<div class="line">      <a class="code" href="namespaceVisualization.html">Visualization</a>::Static* icon() const;</div>
<div class="line">      <a class="code" href="namespaceVisualization.html">Visualization</a>::Static* elseIcon() const;</div>
<div class="line"></div>
<div class="line">      static <span class="keywordtype">void</span> initializeForms();</div>
<div class="line">      virtual <span class="keywordtype">int</span> determineForm() override;</div>
<div class="line"></div>
<div class="line">   private:</div>
<div class="line">      <a class="code" href="namespaceVisualization.html">Visualization</a>::NodeWrapper* condition_{};</div>
<div class="line">      VStatementItemList* thenBranch_{};</div>
<div class="line">      VStatementItemList* elseBranch_{};</div>
<div class="line">      <a class="code" href="classVisualization_1_1Static.html">Visualization::Static</a>* icon_{};</div>
<div class="line">      <a class="code" href="classVisualization_1_1Static.html">Visualization::Static</a>* elseIcon_{};</div>
<div class="line">      <a class="code" href="classVisualization_1_1Line.html">Visualization::Line</a>* elseLine_{};</div>
<div class="line"></div>
<div class="line">      <span class="keywordtype">bool</span> isInsideAnotherIf() <span class="keyword">const</span>;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">inline</span> <a class="code" href="classVisualization_1_1NodeWrapper.html">Visualization::NodeWrapper</a>* <a class="code" href="classOOVisualization_1_1VIfStatement.html#ab70638f50f5d5076f78a49b31ac06168">VIfStatement::condition</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classOOVisualization_1_1VIfStatement.html#aef356ffe3060db4cbf7e69d68f2d029e">condition_</a>; }</div>
<div class="line"><span class="keyword">inline</span> VStatementItemList* <a class="code" href="classOOVisualization_1_1VIfStatement.html#a2a127220029ae79e11e673b2d638ce02">VIfStatement::thenBranch</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classOOVisualization_1_1VIfStatement.html#a72d3792d8fdcadd52e67b3ef7036426d">thenBranch_</a>; }</div>
<div class="line"><span class="keyword">inline</span> VStatementItemList* <a class="code" href="classOOVisualization_1_1VIfStatement.html#ae2fa324ff18da0a7a27df426b2b86693">VIfStatement::elseBranch</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classOOVisualization_1_1VIfStatement.html#a386896ed5bb3b0a0a3954da7e3cad110">elseBranch_</a>; }</div>
<div class="line"><span class="keyword">inline</span> <a class="code" href="classVisualization_1_1Static.html">Visualization::Static</a>* <a class="code" href="classOOVisualization_1_1VIfStatement.html#a40b548ee7f794efb4bd91a96043c42ea">VIfStatement::icon</a>()<span class="keyword"> const </span>{<span class="keywordflow">return</span> <a class="code" href="classOOVisualization_1_1VIfStatement.html#a730d4e0556468a8b5df8b282b7a4505a">icon_</a>;}</div>
<div class="line"><span class="keyword">inline</span> <a class="code" href="classVisualization_1_1Static.html">Visualization::Static</a>* <a class="code" href="classOOVisualization_1_1VIfStatement.html#aa38dcfbf30b7ccc854ca5b57b79f5450">VIfStatement::elseIcon</a>()<span class="keyword"> const </span>{<span class="keywordflow">return</span> <a class="code" href="classOOVisualization_1_1VIfStatement.html#a85c4d3c3560cd86bc93c97ffc96e2612">elseIcon_</a>;}</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment --><p>Let's examine it starting from the top. The first interesting bit after the includes is: <div class="fragment"><div class="line"><span class="keyword">class </span>OOVISUALIZATION_API VIfStatement</div>
<div class="line">   : <span class="keyword">public</span> <a class="code" href="classCore_1_1Reflect.html">Super</a>&lt;VStatementItem&lt;VIfStatement, Visualization::DeclarativeItem&lt;VIfStatement&gt;,</div>
<div class="line">     OOModel::IfStatement&gt;&gt;</div>
<div class="line">{</div>
</div><!-- fragment --></p>
<p>When creating visualizations a lot of functionality is configured by inheriting from appropriate template classes.</p>
<p>Like for nodes, we use the <code>Super</code> template to specify the base class.</p>
<p>In this case the 'real' base class is <a class="el" href="classOOVisualization_1_1VStatementItem.html">OOVisualization::VStatementItem</a>. <a class="el" href="classOOVisualization_1_1VStatementItem.html">OOVisualization::VStatementItem</a> is really just a very thin wrapper on top of the <a class="el" href="classVisualization_1_1ItemWithNode.html">Visualization::ItemWithNode</a>. The only reason we use <a class="el" href="classOOVisualization_1_1VStatementItem.html">OOVisualization::VStatementItem</a> is so that we can later set a default handler for all visualizations of statements. This is not important for this tutorial, so we'll just use the fact that we inherit from <a class="el" href="classVisualization_1_1ItemWithNode.html">Visualization::ItemWithNode</a>. What is this template?</p>
<p>An item either stands on its own or represents the contents of a node. Examples of the former are labels, decorative lines, and icons, while examples of the latter are visualizations of classes, methods, expressions, etc. Items, which do not represent a node, inherit directly from <a class="el" href="classVisualization_1_1Item.html">Visualization::Item</a>, whereas items that visualize a particular node type inherit from <a class="el" href="classVisualization_1_1ItemWithNode.html">Visualization::ItemWithNode</a> (which ultimately also inherits from <a class="el" href="classVisualization_1_1Item.html">Visualization::Item</a>). This class provides the necessary association between the visualization and an instance of a node that our visualization represents. We can gain access to this instance by using the <code>node()</code> method within our visualization. The <a class="el" href="classVisualization_1_1ItemWithNode.html">Visualization::ItemWithNode</a> template requires 3 parameters:</p><ul>
<li>The visualization that is currently being defined (in this case <a class="el" href="classOOVisualization_1_1VIfStatement.html">OOVisualization::VIfStatement</a>)</li>
<li>The base item type (in this case <a class="el" href="classVisualization_1_1DeclarativeItem.html" title="The DeclarativeItem class is the base class for all items that use the declarative API for visualizat...">Visualization::DeclarativeItem</a> since we want to use layouts)</li>
<li>The type of the node that's being visualized (in this case <a class="el" href="classOOModel_1_1IfStatement.html">OOModel::IfStatement</a>)</li>
</ul>
<p>The first and last bit are straight forward, but let's look at the second argument. In essence <a class="el" href="classVisualization_1_1ItemWithNode.html">Visualization::ItemWithNode</a> will inherit from whatever class we provide here. This needs to be a sub type of <a class="el" href="classVisualization_1_1Item.html">Visualization::Item</a>. By specifying <a class="el" href="classVisualization_1_1DeclarativeItem.html" title="The DeclarativeItem class is the base class for all items that use the declarative API for visualizat...">Visualization::DeclarativeItem</a> we make it one of the super types of <a class="el" href="classOOVisualization_1_1VIfStatement.html">OOVisualization::VIfStatement</a> and can make use of its services which greatly simplify the layouting of child items.</p>
<p>Here is the complete type hierarchy of the <a class="el" href="classOOVisualization_1_1VIfStatement.html">OOVisualization::VIfStatement</a> visualization:</p>
<p><a class="el" href="classOOVisualization_1_1VIfStatement.html">OOVisualization::VIfStatement</a> &lt;&ndash; Super &lt;&ndash; <a class="el" href="classOOVisualization_1_1VStatementItem.html">OOVisualization::VStatementItem</a> &lt;&ndash; <a class="el" href="classVisualization_1_1ItemWithNode.html">Visualization::ItemWithNode</a> &lt;&ndash; <a class="el" href="classVisualization_1_1DeclarativeItem.html" title="The DeclarativeItem class is the base class for all items that use the declarative API for visualizat...">Visualization::DeclarativeItem</a> &lt;&ndash; <a class="el" href="classVisualization_1_1DeclarativeItemBase.html" title="The non-template base class for DeclarativeItem. ">Visualization::DeclarativeItemBase</a> &lt;&ndash; <a class="el" href="classVisualization_1_1Item.html">Visualization::Item</a> &lt;&ndash; QGraphicsItem</p>
<p>A note on the name of the visualization class: when you create a new 'stand-alone' item, you are free to call it anything. By convention, items that visualize nodes from the tree should have the same name as the node type, with a 'V' prefix (for visualization). In our example we are visualizing nodes of type <a class="el" href="classOOModel_1_1IfStatement.html">OOModel::IfStatement</a> so the corresponding item class is called <a class="el" href="classOOVisualization_1_1VIfStatement.html">OOVisualization::VIfStatement</a>.</p>
<p>Next comes this line: <div class="fragment"><div class="line">   ITEM_COMMON(VIfStatement)</div>
</div><!-- fragment --> All items must include this macro as the first line in their declaration. This is similar to what we saw when creating new nodes - we use this macro to save us writing a ton of boilerplate code manually (unfortunately, it's not possible to replace the macro with a template solution). Among other things, this macro defines the style for this item to be a class called just like the item class with an added "Style" suffix. In this case the style class for <a class="el" href="classOOVisualization_1_1VIfStatement.html">OOVisualization::VIfStatement</a> is <a class="el" href="classOOVisualization_1_1VIfStatementStyle.html">OOVisualization::VIfStatementStyle</a>. Sometimes it is useful to manually specify what the style class for an item should be called (e.g. when you want to use the same style for multiple items). In that case you can use the macro <code>ITEM_COMMON_CUSTOM_STYLENAME</code> instead which also takes an additional style class name as an argument.</p>
<p>For more info about styles see <a class="el" href="dev_tut_add_vis.html#styles">Item styles</a> at the end of this tutorial.</p>
<p>Next we have the constructor:</p>
<p><div class="fragment"><div class="line">      VIfStatement(Item* parent, NodeType* node, <span class="keyword">const</span> StyleType* style = itemStyles().<span class="keyword">get</span>());</div>
</div><!-- fragment --> All items representing a node (inheriting from <a class="el" href="classVisualization_1_1ItemWithNode.html">Visualization::ItemWithNode</a>) must have a constructor of this form. The <em>style</em> argument should always be initialized by default to <code>itemStyles()</code>.get() - equivalent to <code>itemStyles()</code>.get("default") - which returns the default style. <code>itemStyles()</code> is a static method introduced by the <code>ITEM_COMMON</code> macro. You can use <code>itemStyles()</code>.get(styleName) to get the style defined by the file called <em>styleName</em> in the item's style directory.</p>
<p>Items that do not visualize nodes, must declare a similar constructor but omit the <code>node</code> parameter.</p>
<p>After the constructor we have just a few getter methods for the correspondingly named fields: <div class="fragment"><div class="line">      <a class="code" href="classVisualization_1_1NodeWrapper.html">Visualization::NodeWrapper</a>* condition() <span class="keyword">const</span>;</div>
<div class="line">      VStatementItemList* thenBranch() <span class="keyword">const</span>;</div>
<div class="line">      VStatementItemList* elseBranch() <span class="keyword">const</span>;</div>
<div class="line">      <a class="code" href="classVisualization_1_1Static.html">Visualization::Static</a>* icon() <span class="keyword">const</span>;</div>
<div class="line">      <a class="code" href="classVisualization_1_1Static.html">Visualization::Static</a>* elseIcon() <span class="keyword">const</span>;</div>
</div><!-- fragment --></p>
<p>Nothing special, let's go on to the first important method definition: <div class="fragment"><div class="line">      <span class="keyword">static</span> <span class="keywordtype">void</span> initializeForms();</div>
</div><!-- fragment --> This is a static method required by <a class="el" href="classVisualization_1_1DeclarativeItem.html" title="The DeclarativeItem class is the base class for all items that use the declarative API for visualizat...">Visualization::DeclarativeItem</a>. This method defines the layout for all children of the class. We will see how this is done when discussing the <code></code>.cpp file.</p>
<p>Next comes another related method: <div class="fragment"><div class="line">      <span class="keyword">virtual</span> <span class="keywordtype">int</span> determineForm() <span class="keyword">override</span>;</div>
</div><!-- fragment --> This is another method used by <a class="el" href="classVisualization_1_1DeclarativeItem.html" title="The DeclarativeItem class is the base class for all items that use the declarative API for visualizat...">Visualization::DeclarativeItem</a>. A declarative item may declare multiple forms (layouts). If this is the case, then the <code>determineForm()</code> method should be overridden in order to tell the declarative framework which form to use. Many items only declare a single layout, in which case there is no need to redefine this method.</p>
<p>Some visualizations have an additional important method here and <a class="el" href="classOOVisualization_1_1VIfStatement.html">OOVisualization::VIfStatement</a> used to have it:  <div class="fragment"><div class="line">      <span class="keyword">virtual</span> <span class="keywordtype">void</span> updateGeometry(<span class="keywordtype">int</span> availableWidth, <span class="keywordtype">int</span> availableHeight) <span class="keyword">override</span>;</div>
</div><!-- fragment -->  To understand this method we will first explain Envision's visualization mechanism in more detail.</p>
<p>To improve performance the visualization work flow is split into two major parts:</p><ul>
<li>Painting on the scene</li>
<li>Updating the visualizations</li>
</ul>
<p><b>Painting</b> is mostly controlled by Qt. Various events trigger a repaint of the whole scene or parts of it. These are for example scrolling the view, zooming in and out, interacting with the view, etc. Parts of the scene are repainted often and Qt decides which items should be repainted. When an item needs to be repainted its <code>paint()</code> method is called directly by Qt. Leaf items should reimplement this method in order to draw something. More often however, items do not paint anything - they just include child items which do the drawing. In that case there is no need to redefine the method.</p>
<p>The default implementation of <code>paint()</code> provided by <a class="el" href="classVisualization_1_1Item.html">Visualization::Item</a> takes care of drawing a background shape if any has been specified in the style.</p>
<p><b>Updating</b> is part of the overall visualization mechanism defined by Envision. In order to make sure we do not always recompute the entire scene, we only update items that need to be updated. For instance, if you just rename a class, only that class and all its (visual) parents need to be updated - you don't need to recompute the layout for an unrelated class or package. Envision automatically detects some situations that require an update to an item, and you can manually request that a particular item be updated. Whenever an item is marked for updating, all of its parent items are also marked for updating and the update begins at the root item. The update procedure is recursive and is embodied by the <a class="el" href="classVisualization_1_1Item.html#af5fd4ff62001cc2b45e3546c3a3b5eb2">Visualization::Item::updateSubtree()</a> method. This is what happens when an item is being updated:</p><ol type="1">
<li>The update proceeds only if the item has been marked for update, otherwise nothing happens.</li>
<li>All child items are determined. <a class="el" href="classVisualization_1_1Item.html">Visualization::Item</a> declares a pure virtual method <code>determineChildren()</code> whose sole purpose is to make sure that any child items have been created and set as children. Derived items should reimplement this method and maintain any child items in it. The method can also be empty if there are no child items.</li>
<li>All child items that need updating are updated. This is a recursive call to <code>updateSubtree()</code> .</li>
<li>The item's geometry is calculated. After all of the item's children have been fully updated and their sizes are known, the item must calculate its own geometry. <a class="el" href="classVisualization_1_1Item.html">Visualization::Item</a> declares another pure virtual method called <code>updateGeometry()</code>. Derived classes must reimplement it and do at least the following two:<ul>
<li>Set the position of all child elements. This is the layouting step, where we determine how our child elements should be positioned on screen. Keep in mind that all children should be drawn at non-negative <code>x</code> and <code>y</code> positions.</li>
<li>Set the item's own size by calling <code>setSize()</code>. It is important that the size we set completely engulfs all child elements. Child items should never 'stick' out of their parent element.</li>
</ul>
Some items have a variable size depending on where they are put. For example, horizontal lines expand in order to fill all the available space. To achieve this behavior an items must reimplement <code>sizeDependsOnParent()</code> to return <code>true</code>. This causes <code>updateGeometry()</code> to be called twice for this item:<ol type="a">
<li>When it is first updated, the method is called with arguments 0, 0. These arguments indicate the <code>availableWidth</code> and <code>availableHeight</code>. Whenever they are both zero, this means that the item can take as much space as it needs and the parent item will make sure to accommodate it. All items always receive such a call to <code>updateGeometry()</code>.</li>
<li>After the parent has positioned all its children and set its size to engulf all child items, it should call the <code>updateGeometry()</code> method again for any children that indicate their size depends on the parent's size. This time at least one argument of <code>updateGeometry()</code> will be positive, indicating how much space the item can take in total in that direction, without changing the layout of the parent. The item can stretch to fill all the available space. If one of the arguments to <code>updateGeometry()</code> is 0, this means that the item should retain its current size in that direction. Any positive arguments provided in this second call to <code>updateGeometry()</code> can only indicate that at least as much space is available as the item originally requested, that is an item will never have to shrink in this second call, only expand.</li>
</ol>
The way this works for the line item is that it sets up a default line that is let's say 20 pixels long on the first call to <code>updateGeometry()</code>. Then during the second call the line will expand to take any extra space (say 270 pixels). Notice that there is no drawing during these calls, we merely setup the parameters that will be used for drawing later.</li>
</ol>
<p>Now, why did <a class="el" href="classOOVisualization_1_1VIfStatement.html">OOVisualization::VIfStatement</a> have an <code>updateGeometry()</code> method and why isn't it needed any more. The simple answer is that the visualization of if statements used to be a little more complex, but isn't anymore. Previously an if statement would display its then an else branches either vertically (else under then) or horizontally (else to the right of then). This was a nice little trick but we found that people get confused and so removed this behavior. To able to achieve this it was necessary to reimplement the <code>updateGeometry()</code> method. A frequent reason for reimplementing this method is to get more information. This was also the case for <a class="el" href="classOOVisualization_1_1VIfStatement.html">OOVisualization::VIfStatement</a>. We know that the <code>updateGeometry()</code> method will be called after all children have been drawn. The reimplementation here just needed to know the size of these child items, that's all. It doesn't actually do anything and calls the overriden implementation to do all the heavy lifting. Based on the size of the children we had to make a choice of a horizontal or vertical arrangement and trigger a <code>RepeatUpdate</code> if the arrangement changed.</p>
<p>Afterwards we have the fileds that will hold subitems: <div class="fragment"><div class="line">      <a class="code" href="classVisualization_1_1NodeWrapper.html">Visualization::NodeWrapper</a>* condition_{};</div>
<div class="line">      VStatementItemList* thenBranch_{};</div>
<div class="line">      VStatementItemList* elseBranch_{};</div>
<div class="line">      <a class="code" href="classVisualization_1_1Static.html">Visualization::Static</a>* icon_{};</div>
<div class="line">      <a class="code" href="classVisualization_1_1Static.html">Visualization::Static</a>* elseIcon_{};</div>
<div class="line">      <a class="code" href="classVisualization_1_1Line.html">Visualization::Line</a>* elseLine_{};</div>
</div><!-- fragment --> There are some fields that will hold child items and another one called <code>horizontal</code> that will control which form will be used to arrange the children.</p>
<p>When choosing which form to render we need to know if this if is inside another if: <div class="fragment"><div class="line">      <span class="keywordtype">bool</span> isInsideAnotherIf() <span class="keyword">const</span>;</div>
</div><!-- fragment --></p>
<p>Let's see how it all works in the .cpp file.</p>
<h1><a class="anchor" id="vif_cpp"></a>
VIfStatement.cpp</h1>
<p>Here is <code>VIfStatement.cpp</code> : </p><div class="fragment"><div class="line"><span class="comment">/***********************************************************************************************************************</span></div>
<div class="line"><span class="comment">**</span></div>
<div class="line"><span class="comment">** Copyright (c) 2011, 2014 ETH Zurich</span></div>
<div class="line"><span class="comment">** All rights reserved.</span></div>
<div class="line"><span class="comment">**</span></div>
<div class="line"><span class="comment">** Redistribution and use in source and binary forms, with or without modification, are permitted provided that the</span></div>
<div class="line"><span class="comment">** following conditions are met:</span></div>
<div class="line"><span class="comment">**</span></div>
<div class="line"><span class="comment">**    * Redistributions of source code must retain the above copyright notice, this list of conditions and the following</span></div>
<div class="line"><span class="comment">**      disclaimer.</span></div>
<div class="line"><span class="comment">**    * Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the</span></div>
<div class="line"><span class="comment">**      following disclaimer in the documentation and/or other materials provided with the distribution.</span></div>
<div class="line"><span class="comment">**    * Neither the name of the ETH Zurich nor the names of its contributors may be used to endorse or promote products</span></div>
<div class="line"><span class="comment">**      derived from this software without specific prior written permission.</span></div>
<div class="line"><span class="comment">**</span></div>
<div class="line"><span class="comment">**</span></div>
<div class="line"><span class="comment">** THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES,</span></div>
<div class="line"><span class="comment">** INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</span></div>
<div class="line"><span class="comment">** DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span></div>
<div class="line"><span class="comment">** SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR</span></div>
<div class="line"><span class="comment">** SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,</span></div>
<div class="line"><span class="comment">** WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span></div>
<div class="line"><span class="comment">** OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span></div>
<div class="line"><span class="comment">**</span></div>
<div class="line"><span class="comment">***********************************************************************************************************************/</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;VIfStatement.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;../elements/VStatementItemList.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;VisualizationBase/src/items/Static.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;VisualizationBase/src/items/Line.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;VisualizationBase/src/declarative/DeclarativeItem.hpp&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;VisualizationBase/src/items/NodeWrapper.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;VisualizationBase/src/declarative/BorderFormElement.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespaceVisualization.html">Visualization</a>;</div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespaceOOModel.html">OOModel</a>;</div>
<div class="line"></div>
<div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceOOVisualization.html">OOVisualization</a> {</div>
<div class="line"></div>
<div class="line">DEFINE_ITEM_COMMON(VIfStatement, <span class="stringliteral">&quot;item&quot;</span>)</div>
<div class="line"></div>
<div class="line">VIfStatement::VIfStatement(<a class="code" href="classVisualization_1_1Item.html">Item</a>* parent, NodeType* node, const StyleType* <a class="code" href="namespaceVisualization.html#afae3419fd4744b06c73748aacad1ef3b">style</a>) : <a class="code" href="classCore_1_1Reflect.html">Super</a>{parent, node, <a class="code" href="namespaceVisualization.html#afae3419fd4744b06c73748aacad1ef3b">style</a>}</div>
<div class="line">{}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> VIfStatement::determineForm()</div>
<div class="line">{</div>
<div class="line">   <span class="comment">// Plain if with no else branch</span></div>
<div class="line">   <span class="keywordtype">int</span> formId = 0;</div>
<div class="line">   <span class="keywordflow">if</span> (node()-&gt;elseBranch() &amp;&amp; node()-&gt;elseBranch()-&gt;<a class="code" href="namespaceOODebug.html#a2fe2d8d116e797c0f0a92272bc9b0a56">size</a>() &gt; 0)</div>
<div class="line">   {</div>
<div class="line">      <span class="keywordflow">if</span> (node()-&gt;elseBranch()-&gt;<a class="code" href="namespaceOODebug.html#a2fe2d8d116e797c0f0a92272bc9b0a56">size</a>() == 1 &amp;&amp; DCast&lt;IfStatement&gt;(node()-&gt;elseBranch()-&gt;first()))</div>
<div class="line">         formId = 2; <span class="comment">// else contains only an if</span></div>
<div class="line">      <span class="keywordflow">else</span></div>
<div class="line">         formId = 1; <span class="comment">// standard else</span></div>
<div class="line">   }</div>
<div class="line"></div>
<div class="line">   <span class="keywordflow">if</span> (isInsideAnotherIf())</div>
<div class="line">      formId += 3; <span class="comment">// Make the if stretchable</span></div>
<div class="line"></div>
<div class="line">   <span class="keywordflow">return</span> formId;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> VIfStatement::initializeForms()</div>
<div class="line">{</div>
<div class="line">   <span class="keyword">auto</span> icon = item&lt;Static&gt;(&amp;I::icon_, [](I* v){</div>
<div class="line">         <span class="keywordflow">if</span> (v-&gt;node()-&gt;parent() &amp;&amp; v-&gt;node()-&gt;parent()-&gt;parent() )</div>
<div class="line">         {</div>
<div class="line">            <span class="keywordflow">if</span> (<span class="keyword">auto</span> ifs = DCast&lt;IfStatement&gt;(v-&gt;node()-&gt;parent()-&gt;parent()))</div>
<div class="line">               <span class="keywordflow">if</span> ( ifs-&gt;elseBranch() == v-&gt;node()-&gt;parent())</div>
<div class="line">                  <span class="keywordflow">return</span> &amp;v-&gt;style()-&gt;elificon();</div>
<div class="line">         }</div>
<div class="line">         <span class="keywordflow">return</span> &amp;v-&gt;style()-&gt;icon();</div>
<div class="line">      });</div>
<div class="line"></div>
<div class="line">   <span class="keyword">auto</span> condition = item&lt;NodeWrapper&gt;(&amp;I::condition_, [](I* v){<span class="keywordflow">return</span> v-&gt;node()-&gt;condition();},</div>
<div class="line">         [](I* v){<span class="keywordflow">return</span> &amp;v-&gt;style()-&gt;condition();});</div>
<div class="line"></div>
<div class="line">   <span class="comment">// We need the grid for stretching</span></div>
<div class="line">   <span class="keyword">auto</span> header = grid({{(<span class="keyword">new</span> <a class="code" href="classVisualization_1_1AnchorLayoutFormElement.html">AnchorLayoutFormElement</a>{})</div>
<div class="line">                        -&gt;put(TheVCenterOf, icon, AtVCenterOf, condition)</div>
<div class="line">                        -&gt;put(TheHCenterOf, icon, AtLeftOf, condition)}})</div>
<div class="line">         -&gt;setColumnStretchFactor(1, 1);</div>
<div class="line"></div>
<div class="line">   <span class="comment">// The grid is needed to enable strectching</span></div>
<div class="line">   <span class="keyword">auto</span> elseIcon = grid({{item&lt;Static&gt;(&amp;I::elseIcon_, &amp;StyleType::elseIcon)}})</div>
<div class="line">         -&gt;setColumnStretchFactor(1, 1)</div>
<div class="line">         -&gt;setNoBoundaryCursors([](<a class="code" href="classVisualization_1_1Item.html">Item</a>*){<span class="keywordflow">return</span> <span class="keyword">true</span>;})-&gt;setNoInnerCursors([](<a class="code" href="classVisualization_1_1Item.html">Item</a>*){<span class="keywordflow">return</span> <span class="keyword">true</span>;});</div>
<div class="line"></div>
<div class="line">   <span class="comment">// The grid is needed to enable strectching</span></div>
<div class="line">   <span class="keyword">auto</span> thenBranch = grid({{item&lt;VStatementItemList&gt;(&amp;I::thenBranch_, [](I* v){<span class="keywordflow">return</span> v-&gt;node()-&gt;thenBranch();},</div>
<div class="line">                                                [](I* v){<span class="keywordflow">return</span> &amp;v-&gt;style()-&gt;thenBranch();})}})</div>
<div class="line">         -&gt;setColumnStretchFactor(1, 1)-&gt;setRowStretchFactor(0, 1)-&gt;setHorizontalSpacing(5)</div>
<div class="line">         -&gt;setNoBoundaryCursors([](<a class="code" href="classVisualization_1_1Item.html">Item</a>*){<span class="keywordflow">return</span> <span class="keyword">true</span>;})-&gt;setNoInnerCursors([](<a class="code" href="classVisualization_1_1Item.html">Item</a>*){<span class="keywordflow">return</span> <span class="keyword">true</span>;});</div>
<div class="line"></div>
<div class="line">   <span class="comment">// The grid is needed to enable strectching</span></div>
<div class="line">   <span class="keyword">auto</span> elseBranch = grid({{item&lt;VStatementItemList&gt;(&amp;I::elseBranch_, [](I* v){<span class="keywordflow">return</span> v-&gt;node()-&gt;elseBranch();},</div>
<div class="line">                                                [](I* v){<span class="keywordflow">return</span> &amp;v-&gt;style()-&gt;elseBranch();})}})</div>
<div class="line">         -&gt;setColumnStretchFactor(1, 1)-&gt;setRowStretchFactor(0, 1)-&gt;setHorizontalSpacing(5)</div>
<div class="line">         -&gt;setNoBoundaryCursors([](<a class="code" href="classVisualization_1_1Item.html">Item</a>*){<span class="keywordflow">return</span> <span class="keyword">true</span>;})-&gt;setNoInnerCursors([](<a class="code" href="classVisualization_1_1Item.html">Item</a>*){<span class="keywordflow">return</span> <span class="keyword">true</span>;});</div>
<div class="line"></div>
<div class="line">   <span class="keyword">auto</span> shapeElement = <span class="keyword">new</span> <a class="code" href="classVisualization_1_1ShapeFormElement.html">ShapeFormElement</a>{};</div>
<div class="line"></div>
<div class="line">   <span class="comment">// Form 0: no else branch</span></div>
<div class="line">   <span class="keyword">auto</span> topLevelIfWithoutElse = (<span class="keyword">new</span> <a class="code" href="classVisualization_1_1AnchorLayoutFormElement.html">AnchorLayoutFormElement</a>{})</div>
<div class="line">         -&gt;put(TheTopOf, thenBranch, 3, FromBottomOf, header)</div>
<div class="line">         -&gt;put(TheTopOf, shapeElement, AtCenterOf, header)</div>
<div class="line">         -&gt;put(TheLeftOf, shapeElement, -10, FromLeftOf, header)</div>
<div class="line">         -&gt;put(TheLeftOf, shapeElement, 5, FromLeftOf, thenBranch)</div>
<div class="line">         -&gt;put(TheRightOf, header, AtRightOf, thenBranch)</div>
<div class="line">         -&gt;put(TheRightOf, shapeElement, 3, FromRightOf, header)</div>
<div class="line">         -&gt;put(TheBottomOf, shapeElement, 3, FromBottomOf, thenBranch)</div>
<div class="line">         -&gt;put(TheRightOf, shapeElement, 3, FromRightOf, thenBranch);</div>
<div class="line"></div>
<div class="line">   addForm(topLevelIfWithoutElse);</div>
<div class="line"></div>
<div class="line">   <span class="comment">// Form 1: then and else branch arranged vertically</span></div>
<div class="line">   <span class="keyword">auto</span> elseHorizontalLineElement = item&lt;Line&gt;(&amp;I::elseLine_, [](I* v){<span class="keywordflow">return</span> &amp;v-&gt;style()-&gt;elseHorizontalLine();});</div>
<div class="line">   <span class="keyword">auto</span> topLevelIfAndStandardElse = (<span class="keyword">new</span> <a class="code" href="classVisualization_1_1AnchorLayoutFormElement.html">AnchorLayoutFormElement</a>{})</div>
<div class="line">         -&gt;put(TheTopOf, thenBranch, 3, FromBottomOf, header)</div>
<div class="line">         -&gt;put(TheLeftOf, elseIcon, AtLeftOf, header)</div>
<div class="line">         -&gt;put(TheLeftOf, elseBranch, AtLeftOf, thenBranch)</div>
<div class="line">         -&gt;put(TheTopOf, shapeElement, AtCenterOf, header)</div>
<div class="line">         -&gt;put(TheLeftOf, shapeElement, -10, FromLeftOf, header)</div>
<div class="line">         -&gt;put(TheLeftOf, shapeElement, 5, FromLeftOf, thenBranch)</div>
<div class="line">         -&gt;put(TheTopOf, elseIcon, 3, FromBottomOf, thenBranch)</div>
<div class="line">         -&gt;put(TheRightOf, shapeElement, 3, FromRightOf, thenBranch)</div>
<div class="line">         -&gt;put(TheRightOf, shapeElement, 3, FromRightOf, elseBranch)</div>
<div class="line">         -&gt;put(TheRightOf, shapeElement, 3, FromRightOf, header)</div>
<div class="line">         -&gt;put(TheTopOf, elseBranch, 3, FromBottomOf, elseIcon)</div>
<div class="line">         -&gt;put(TheBottomOf, shapeElement, 3, FromBottomOf, elseBranch)</div>
<div class="line"></div>
<div class="line">         -&gt;put(TheVCenterOf, elseHorizontalLineElement, AtVCenterOf, elseIcon)</div>
<div class="line">         -&gt;put(TheLeftOf, elseHorizontalLineElement, AtRightOf, elseIcon)</div>
<div class="line">         -&gt;put(TheRightOf, elseHorizontalLineElement, AtRightOf, shapeElement);</div>
<div class="line"></div>
<div class="line">   addForm(topLevelIfAndStandardElse);</div>
<div class="line"></div>
<div class="line">   <span class="comment">// Form 2: then branch and then a following if else statement</span></div>
<div class="line">   <span class="keyword">auto</span> elseIfBranch = item&lt;VStatementItemList&gt;(&amp;I::elseBranch_, [](I* v){<span class="keywordflow">return</span> v-&gt;node()-&gt;elseBranch();},</div>
<div class="line">                                                [](I* v){<span class="keywordflow">return</span> &amp;v-&gt;style()-&gt;elseIfBranch();});</div>
<div class="line">   <span class="keyword">auto</span> topLevelIfAndElseIf = (<span class="keyword">new</span> <a class="code" href="classVisualization_1_1AnchorLayoutFormElement.html">AnchorLayoutFormElement</a>{})</div>
<div class="line">         -&gt;put(TheTopOf, thenBranch, 3, FromBottomOf, header)</div>
<div class="line">         -&gt;put(TheTopOf, shapeElement, AtCenterOf, header)</div>
<div class="line">         -&gt;put(TheLeftOf, shapeElement, -10, FromLeftOf, header)</div>
<div class="line">         -&gt;put(TheLeftOf, shapeElement, 5, FromLeftOf, thenBranch)</div>
<div class="line">         -&gt;put(TheRightOf, header, AtRightOf, thenBranch)</div>
<div class="line">         -&gt;put(TheRightOf, shapeElement, 3, FromRightOf, header)</div>
<div class="line">         -&gt;put(TheBottomOf, shapeElement, AtBottomOf, elseIfBranch)</div>
<div class="line">         -&gt;put(TheTopOf, elseIfBranch, 2, FromBottomOf, thenBranch)</div>
<div class="line">         -&gt;put(TheLeftOf, elseIfBranch, AtLeftOf, header)</div>
<div class="line">         -&gt;put(TheRightOf, elseIfBranch, AtRightOf, shapeElement);</div>
<div class="line"></div>
<div class="line">   addForm(topLevelIfAndElseIf);</div>
<div class="line"></div>
<div class="line">   <span class="comment">// The stretch versions of the forms</span></div>
<div class="line">   <span class="keyword">auto</span> borderElement = <span class="keyword">new</span> <a class="code" href="classVisualization_1_1BorderFormElement.html">BorderFormElement</a>{};</div>
<div class="line">   addForm(topLevelIfWithoutElse-&gt;clone()</div>
<div class="line">           -&gt;put(TheRightOf, shapeElement, AtRightOf, borderElement)</div>
<div class="line">           -&gt;put(TheLeftOf, header, AtLeftOf, borderElement));</div>
<div class="line">   addForm(topLevelIfAndStandardElse-&gt;clone()</div>
<div class="line">           -&gt;put(TheRightOf, shapeElement, AtRightOf, borderElement)</div>
<div class="line">           -&gt;put(TheLeftOf, header, AtLeftOf, borderElement));</div>
<div class="line">   addForm(topLevelIfAndElseIf-&gt;clone()</div>
<div class="line">           -&gt;put(TheRightOf, shapeElement, AtRightOf, borderElement)</div>
<div class="line">           -&gt;put(TheLeftOf, header, AtLeftOf, borderElement));</div>
<div class="line"></div>
<div class="line">   <span class="comment">// Add margins to top-level ifs</span></div>
<div class="line">   topLevelIfWithoutElse-&gt;<a class="code" href="classVisualization_1_1SuperFormElement.html#a346723a22aa1ea9a703eafd23f13207d">setBottomMargin</a>(10);</div>
<div class="line">   topLevelIfAndStandardElse-&gt;<a class="code" href="classVisualization_1_1SuperFormElement.html#a346723a22aa1ea9a703eafd23f13207d">setBottomMargin</a>(10);</div>
<div class="line">   topLevelIfAndElseIf-&gt;<a class="code" href="classVisualization_1_1SuperFormElement.html#a346723a22aa1ea9a703eafd23f13207d">setBottomMargin</a>(10);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">bool</span> VIfStatement::isInsideAnotherIf()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword"></span>{</div>
<div class="line">   <span class="keywordflow">return</span> parent() &amp;&amp; parent()-&gt;<a class="code" href="classVisualization_1_1FormElement.html#a38daf5ea82ae237656bbc5be6c111d13">parent</a>() &amp;&amp; parent()-&gt;<a class="code" href="classVisualization_1_1FormElement.html#a38daf5ea82ae237656bbc5be6c111d13">parent</a>()-&gt;typeId() == typeIdStatic();</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment --><p>The first thing to notice is this inlcude: <div class="fragment"><div class="line"><span class="preprocessor">#include &quot;VisualizationBase/src/declarative/DeclarativeItem.hpp&quot;</span></div>
</div><!-- fragment --> We need to include this additional definitions header pertaining to the <a class="el" href="classVisualization_1_1DeclarativeItem.html" title="The DeclarativeItem class is the base class for all items that use the declarative API for visualizat...">Visualization::DeclarativeItem</a> framework.</p>
<p>Next is: <div class="fragment"><div class="line">DEFINE_ITEM_COMMON(VIfStatement, <span class="stringliteral">&quot;item&quot;</span>)</div>
</div><!-- fragment --> which complements the <code>ITEM_COMMON</code> declaration in the header file. The second argument indicates which subdirectory of <code>/styles</code> we should look in for the <code>/VIfStatement</code> directory that contains all styles for this class. Possible choices here are <em>"item"</em>, <em>"icon"</em> and <em>"layout"</em> for now.</p>
<p>The constructor: <div class="fragment"><div class="line">VIfStatement::VIfStatement(Item* parent, NodeType* node, <span class="keyword">const</span> StyleType* style) : <a class="code" href="classCore_1_1Reflect.html">Super</a>{parent, node, style}</div>
</div><!-- fragment --> is typical for items deriving from <a class="el" href="classVisualization_1_1DeclarativeItem.html" title="The DeclarativeItem class is the base class for all items that use the declarative API for visualizat...">Visualization::DeclarativeItem</a>, we just forward the arguments.</p>
<p>In the <code>determineForm()</code> method we choose which form we use to render the if statement. There are several choices there depending on whether the if is inside another if or not. These are mainly there to make the rendering of longer <code>if</code> <code>else</code> <code>if</code> <code>else</code> <code>if</code> <code>else</code> chains nicer. <div class="fragment"><div class="line"><span class="keywordtype">int</span> VIfStatement::determineForm()</div>
<div class="line">{</div>
<div class="line">   <span class="comment">// Plain if with no else branch</span></div>
<div class="line">   <span class="keywordtype">int</span> formId = 0;</div>
<div class="line">   <span class="keywordflow">if</span> (node()-&gt;elseBranch() &amp;&amp; node()-&gt;elseBranch()-&gt;<a class="code" href="namespaceOODebug.html#a2fe2d8d116e797c0f0a92272bc9b0a56">size</a>() &gt; 0)</div>
<div class="line">   {</div>
<div class="line">      <span class="keywordflow">if</span> (node()-&gt;elseBranch()-&gt;<a class="code" href="namespaceOODebug.html#a2fe2d8d116e797c0f0a92272bc9b0a56">size</a>() == 1 &amp;&amp; DCast&lt;IfStatement&gt;(node()-&gt;elseBranch()-&gt;first()))</div>
<div class="line">         formId = 2; <span class="comment">// else contains only an if</span></div>
<div class="line">      <span class="keywordflow">else</span></div>
<div class="line">         formId = 1; <span class="comment">// standard else</span></div>
<div class="line">   }</div>
<div class="line"></div>
<div class="line">   <span class="keywordflow">if</span> (isInsideAnotherIf())</div>
<div class="line">      formId += 3; <span class="comment">// Make the if stretchable</span></div>
<div class="line"></div>
<div class="line">   <span class="keywordflow">return</span> formId;</div>
<div class="line">}</div>
</div><!-- fragment --></p>
<p>Finally let's see the real work that we need to do in order to use <a class="el" href="classVisualization_1_1DeclarativeItem.html" title="The DeclarativeItem class is the base class for all items that use the declarative API for visualizat...">Visualization::DeclarativeItem</a> - defining the <code>initializeForms()</code> method: <div class="fragment"><div class="line"><span class="keywordtype">void</span> VIfStatement::initializeForms()</div>
<div class="line">{</div>
<div class="line">   <span class="keyword">auto</span> icon = item&lt;Static&gt;(&amp;I::icon_, [](I* v){</div>
<div class="line">         <span class="keywordflow">if</span> (v-&gt;node()-&gt;parent() &amp;&amp; v-&gt;node()-&gt;parent()-&gt;parent() )</div>
<div class="line">         {</div>
<div class="line">            <span class="keywordflow">if</span> (<span class="keyword">auto</span> ifs = DCast&lt;IfStatement&gt;(v-&gt;node()-&gt;parent()-&gt;parent()))</div>
<div class="line">               <span class="keywordflow">if</span> ( ifs-&gt;elseBranch() == v-&gt;node()-&gt;parent())</div>
<div class="line">                  <span class="keywordflow">return</span> &amp;v-&gt;style()-&gt;elificon();</div>
<div class="line">         }</div>
<div class="line">         <span class="keywordflow">return</span> &amp;v-&gt;style()-&gt;icon();</div>
<div class="line">      });</div>
<div class="line"></div>
<div class="line">   <span class="keyword">auto</span> condition = item&lt;NodeWrapper&gt;(&amp;I::condition_, [](I* v){<span class="keywordflow">return</span> v-&gt;node()-&gt;condition();},</div>
<div class="line">         [](I* v){<span class="keywordflow">return</span> &amp;v-&gt;style()-&gt;condition();});</div>
<div class="line"></div>
<div class="line">   <span class="comment">// We need the grid for stretching</span></div>
<div class="line">   <span class="keyword">auto</span> header = grid({{(<span class="keyword">new</span> AnchorLayoutFormElement{})</div>
<div class="line">                        -&gt;put(TheVCenterOf, icon, AtVCenterOf, condition)</div>
<div class="line">                        -&gt;put(TheHCenterOf, icon, AtLeftOf, condition)}})</div>
<div class="line">         -&gt;setColumnStretchFactor(1, 1);</div>
<div class="line"></div>
<div class="line">   <span class="comment">// The grid is needed to enable strectching</span></div>
<div class="line">   <span class="keyword">auto</span> elseIcon = grid({{item&lt;Static&gt;(&amp;I::elseIcon_, &amp;StyleType::elseIcon)}})</div>
<div class="line">         -&gt;setColumnStretchFactor(1, 1)</div>
<div class="line">         -&gt;setNoBoundaryCursors([](Item*){<span class="keywordflow">return</span> <span class="keyword">true</span>;})-&gt;setNoInnerCursors([](Item*){<span class="keywordflow">return</span> <span class="keyword">true</span>;});</div>
<div class="line"></div>
<div class="line">   <span class="comment">// The grid is needed to enable strectching</span></div>
<div class="line">   <span class="keyword">auto</span> thenBranch = grid({{item&lt;VStatementItemList&gt;(&amp;I::thenBranch_, [](I* v){<span class="keywordflow">return</span> v-&gt;node()-&gt;thenBranch();},</div>
<div class="line">                                                [](I* v){<span class="keywordflow">return</span> &amp;v-&gt;style()-&gt;thenBranch();})}})</div>
<div class="line">         -&gt;setColumnStretchFactor(1, 1)-&gt;setRowStretchFactor(0, 1)-&gt;setHorizontalSpacing(5)</div>
<div class="line">         -&gt;setNoBoundaryCursors([](Item*){<span class="keywordflow">return</span> <span class="keyword">true</span>;})-&gt;setNoInnerCursors([](Item*){<span class="keywordflow">return</span> <span class="keyword">true</span>;});</div>
<div class="line"></div>
<div class="line">   <span class="comment">// The grid is needed to enable strectching</span></div>
<div class="line">   <span class="keyword">auto</span> elseBranch = grid({{item&lt;VStatementItemList&gt;(&amp;I::elseBranch_, [](I* v){<span class="keywordflow">return</span> v-&gt;node()-&gt;elseBranch();},</div>
<div class="line">                                                [](I* v){<span class="keywordflow">return</span> &amp;v-&gt;style()-&gt;elseBranch();})}})</div>
<div class="line">         -&gt;setColumnStretchFactor(1, 1)-&gt;setRowStretchFactor(0, 1)-&gt;setHorizontalSpacing(5)</div>
<div class="line">         -&gt;setNoBoundaryCursors([](Item*){<span class="keywordflow">return</span> <span class="keyword">true</span>;})-&gt;setNoInnerCursors([](Item*){<span class="keywordflow">return</span> <span class="keyword">true</span>;});</div>
<div class="line"></div>
<div class="line">   <span class="keyword">auto</span> shapeElement = <span class="keyword">new</span> ShapeFormElement{};</div>
<div class="line"></div>
<div class="line">   <span class="comment">// Form 0: no else branch</span></div>
<div class="line">   <span class="keyword">auto</span> topLevelIfWithoutElse = (<span class="keyword">new</span> AnchorLayoutFormElement{})</div>
<div class="line">         -&gt;put(TheTopOf, thenBranch, 3, FromBottomOf, header)</div>
<div class="line">         -&gt;put(TheTopOf, shapeElement, AtCenterOf, header)</div>
<div class="line">         -&gt;put(TheLeftOf, shapeElement, -10, FromLeftOf, header)</div>
<div class="line">         -&gt;put(TheLeftOf, shapeElement, 5, FromLeftOf, thenBranch)</div>
<div class="line">         -&gt;put(TheRightOf, header, AtRightOf, thenBranch)</div>
<div class="line">         -&gt;put(TheRightOf, shapeElement, 3, FromRightOf, header)</div>
<div class="line">         -&gt;put(TheBottomOf, shapeElement, 3, FromBottomOf, thenBranch)</div>
<div class="line">         -&gt;put(TheRightOf, shapeElement, 3, FromRightOf, thenBranch);</div>
<div class="line"></div>
<div class="line">   addForm(topLevelIfWithoutElse);</div>
<div class="line"></div>
<div class="line">   <span class="comment">// Form 1: then and else branch arranged vertically</span></div>
<div class="line">   <span class="keyword">auto</span> elseHorizontalLineElement = item&lt;Line&gt;(&amp;I::elseLine_, [](I* v){<span class="keywordflow">return</span> &amp;v-&gt;style()-&gt;elseHorizontalLine();});</div>
<div class="line">   <span class="keyword">auto</span> topLevelIfAndStandardElse = (<span class="keyword">new</span> AnchorLayoutFormElement{})</div>
<div class="line">         -&gt;put(TheTopOf, thenBranch, 3, FromBottomOf, header)</div>
<div class="line">         -&gt;put(TheLeftOf, elseIcon, AtLeftOf, header)</div>
<div class="line">         -&gt;put(TheLeftOf, elseBranch, AtLeftOf, thenBranch)</div>
<div class="line">         -&gt;put(TheTopOf, shapeElement, AtCenterOf, header)</div>
<div class="line">         -&gt;put(TheLeftOf, shapeElement, -10, FromLeftOf, header)</div>
<div class="line">         -&gt;put(TheLeftOf, shapeElement, 5, FromLeftOf, thenBranch)</div>
<div class="line">         -&gt;put(TheTopOf, elseIcon, 3, FromBottomOf, thenBranch)</div>
<div class="line">         -&gt;put(TheRightOf, shapeElement, 3, FromRightOf, thenBranch)</div>
<div class="line">         -&gt;put(TheRightOf, shapeElement, 3, FromRightOf, elseBranch)</div>
<div class="line">         -&gt;put(TheRightOf, shapeElement, 3, FromRightOf, header)</div>
<div class="line">         -&gt;put(TheTopOf, elseBranch, 3, FromBottomOf, elseIcon)</div>
<div class="line">         -&gt;put(TheBottomOf, shapeElement, 3, FromBottomOf, elseBranch)</div>
<div class="line"></div>
<div class="line">         -&gt;put(TheVCenterOf, elseHorizontalLineElement, AtVCenterOf, elseIcon)</div>
<div class="line">         -&gt;put(TheLeftOf, elseHorizontalLineElement, AtRightOf, elseIcon)</div>
<div class="line">         -&gt;put(TheRightOf, elseHorizontalLineElement, AtRightOf, shapeElement);</div>
<div class="line"></div>
<div class="line">   addForm(topLevelIfAndStandardElse);</div>
<div class="line"></div>
<div class="line">   <span class="comment">// Form 2: then branch and then a following if else statement</span></div>
<div class="line">   <span class="keyword">auto</span> elseIfBranch = item&lt;VStatementItemList&gt;(&amp;I::elseBranch_, [](I* v){<span class="keywordflow">return</span> v-&gt;node()-&gt;elseBranch();},</div>
<div class="line">                                                [](I* v){<span class="keywordflow">return</span> &amp;v-&gt;style()-&gt;elseIfBranch();});</div>
<div class="line">   <span class="keyword">auto</span> topLevelIfAndElseIf = (<span class="keyword">new</span> AnchorLayoutFormElement{})</div>
<div class="line">         -&gt;put(TheTopOf, thenBranch, 3, FromBottomOf, header)</div>
<div class="line">         -&gt;put(TheTopOf, shapeElement, AtCenterOf, header)</div>
<div class="line">         -&gt;put(TheLeftOf, shapeElement, -10, FromLeftOf, header)</div>
<div class="line">         -&gt;put(TheLeftOf, shapeElement, 5, FromLeftOf, thenBranch)</div>
<div class="line">         -&gt;put(TheRightOf, header, AtRightOf, thenBranch)</div>
<div class="line">         -&gt;put(TheRightOf, shapeElement, 3, FromRightOf, header)</div>
<div class="line">         -&gt;put(TheBottomOf, shapeElement, AtBottomOf, elseIfBranch)</div>
<div class="line">         -&gt;put(TheTopOf, elseIfBranch, 2, FromBottomOf, thenBranch)</div>
<div class="line">         -&gt;put(TheLeftOf, elseIfBranch, AtLeftOf, header)</div>
<div class="line">         -&gt;put(TheRightOf, elseIfBranch, AtRightOf, shapeElement);</div>
<div class="line"></div>
<div class="line">   addForm(topLevelIfAndElseIf);</div>
<div class="line"></div>
<div class="line">   <span class="comment">// The stretch versions of the forms</span></div>
<div class="line">   <span class="keyword">auto</span> borderElement = <span class="keyword">new</span> BorderFormElement{};</div>
<div class="line">   addForm(topLevelIfWithoutElse-&gt;clone()</div>
<div class="line">           -&gt;put(TheRightOf, shapeElement, AtRightOf, borderElement)</div>
<div class="line">           -&gt;put(TheLeftOf, header, AtLeftOf, borderElement));</div>
<div class="line">   addForm(topLevelIfAndStandardElse-&gt;clone()</div>
<div class="line">           -&gt;put(TheRightOf, shapeElement, AtRightOf, borderElement)</div>
<div class="line">           -&gt;put(TheLeftOf, header, AtLeftOf, borderElement));</div>
<div class="line">   addForm(topLevelIfAndElseIf-&gt;clone()</div>
<div class="line">           -&gt;put(TheRightOf, shapeElement, AtRightOf, borderElement)</div>
<div class="line">           -&gt;put(TheLeftOf, header, AtLeftOf, borderElement));</div>
<div class="line"></div>
<div class="line">   <span class="comment">// Add margins to top-level ifs</span></div>
<div class="line">   topLevelIfWithoutElse-&gt;setBottomMargin(10);</div>
<div class="line">   topLevelIfAndStandardElse-&gt;setBottomMargin(10);</div>
<div class="line">   topLevelIfAndElseIf-&gt;setBottomMargin(10);</div>
</div><!-- fragment --> We won't go into detail here, please refer to <a href="http://www.pm.inf.ethz.ch/content/dam/ethz/special-interest/infk/chair-program-method/pm/documents/Education/Theses/Andrea_Helfenstein_BA_report.pdf">Andrea Helfenstein's Bachelor Thesis Report</a> for the various ways to use <a class="el" href="classVisualization_1_1DeclarativeItem.html" title="The DeclarativeItem class is the base class for all items that use the declarative API for visualizat...">Visualization::DeclarativeItem</a>. In short:</p><ul>
<li>We create several elements that are reused in multiple forms: <code>icon</code>, <code>condition</code>, <code>header</code> </li>
<li>We wrap some elements in a grid, just so that the elements can be stretched by their parent if needed. This will not result in any visual stretching since we declare only the last (empty) cell of the grid as stretchable. This is merely needed to satisfy the constraints of the anchor layout.</li>
<li>Then we define three forms that match different situations for an if-statement</li>
<li>Based on these three forms we make three additional forms which are similar but allow the if statement to visually stretch to fill all available space on the right.</li>
<li>Finally we add some margins to the original three forms (not their clones)</li>
</ul>
<p>This is all there is to it - now we have a visualization for if statements that will be automatically used when needed. In simpler cases, all you need to do is define the <code>initializeForms()</code> method and you can create a visual item in no time. It is recommended to look at other examples when creating your own items. An example of a very short item is <a class="el" href="classOOVisualization_1_1VTypeAlias.html">OOVisualization::VTypeAlias</a>, and an example of a more complicated one is <a class="el" href="classOOVisualization_1_1VClass.html">OOVisualization::VClass</a>.</p>
<h1><a class="anchor" id="styles"></a>
Item styles</h1>
<p>Each item type has an associated style type. A style type is a class that contains properties used to determine how exactly the item should be rendered. For example an item rendering text may have a style that tells it what font family and size to use, what text the color should be, should there be a background, etc. The properties defined for a style can be other styles or any number of 'basic' values: numbers, booleans, lists, fonts, brushes, colors, etc. An important feature of styles is that they are dynamically loaded at run-time by reading them from an XML file. Thus all the properties that you specify in a style can be used to alter the appearance of an item, without the need of recompiling any code.</p>
<p>Each item must have at least a default style that specifies all properties listed in the item's style type. Within your plug-in you must put the default style in the <code>/styles/item/ItemName/</code> directory and it should be called <code>default</code>. For the <a class="el" href="classOOVisualization_1_1VIfStatement.html">OOVisualization::VIfStatement</a> this file is <code>/OOVisualization/styles/item/VIfStatement/default</code> .</p>
<p>Creating a style class is straight forward, all you really need to do is list the properties of the style. Here is the header of the style class for if statements <code></code>(VIfStatementStyle.h): </p><div class="fragment"><div class="line"><span class="comment">/***********************************************************************************************************************</span></div>
<div class="line"><span class="comment">**</span></div>
<div class="line"><span class="comment">** Copyright (c) 2011, 2014 ETH Zurich</span></div>
<div class="line"><span class="comment">** All rights reserved.</span></div>
<div class="line"><span class="comment">**</span></div>
<div class="line"><span class="comment">** Redistribution and use in source and binary forms, with or without modification, are permitted provided that the</span></div>
<div class="line"><span class="comment">** following conditions are met:</span></div>
<div class="line"><span class="comment">**</span></div>
<div class="line"><span class="comment">**    * Redistributions of source code must retain the above copyright notice, this list of conditions and the following</span></div>
<div class="line"><span class="comment">**      disclaimer.</span></div>
<div class="line"><span class="comment">**    * Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the</span></div>
<div class="line"><span class="comment">**      following disclaimer in the documentation and/or other materials provided with the distribution.</span></div>
<div class="line"><span class="comment">**    * Neither the name of the ETH Zurich nor the names of its contributors may be used to endorse or promote products</span></div>
<div class="line"><span class="comment">**      derived from this software without specific prior written permission.</span></div>
<div class="line"><span class="comment">**</span></div>
<div class="line"><span class="comment">**</span></div>
<div class="line"><span class="comment">** THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES,</span></div>
<div class="line"><span class="comment">** INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</span></div>
<div class="line"><span class="comment">** DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span></div>
<div class="line"><span class="comment">** SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR</span></div>
<div class="line"><span class="comment">** SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,</span></div>
<div class="line"><span class="comment">** WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span></div>
<div class="line"><span class="comment">** OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span></div>
<div class="line"><span class="comment">**</span></div>
<div class="line"><span class="comment">***********************************************************************************************************************/</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#pragma once</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;../oovisualization_api.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;VisualizationBase/src/layouts/SequentialLayoutStyle.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;VisualizationBase/src/items/VListStyle.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;VisualizationBase/src/items/StaticStyle.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;VisualizationBase/src/items/LineStyle.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceOOVisualization.html">OOVisualization</a> {</div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>OOVISUALIZATION_API VIfStatementStyle : <span class="keyword">public</span> <a class="code" href="classCore_1_1Reflect.html">Super</a>&lt;Visualization::DeclarativeItemBaseStyle&gt;</div>
<div class="line">{</div>
<div class="line">   <span class="keyword">public</span>:</div>
<div class="line">      <span class="keyword">virtual</span> ~VIfStatementStyle() <span class="keyword">override</span>;</div>
<div class="line"></div>
<div class="line">      Property&lt;Visualization::SequentialLayoutStyle&gt; header{<span class="keyword">this</span>, <span class="stringliteral">&quot;header&quot;</span>};</div>
<div class="line">      Property&lt;Visualization::StaticStyle&gt; icon{<span class="keyword">this</span>, <span class="stringliteral">&quot;icon&quot;</span>};</div>
<div class="line">      Property&lt;Visualization::StaticStyle&gt; elseIcon{<span class="keyword">this</span>, <span class="stringliteral">&quot;elseIcon&quot;</span>};</div>
<div class="line">      Property&lt;Visualization::StaticStyle&gt; elificon{<span class="keyword">this</span>, <span class="stringliteral">&quot;elificon&quot;</span>};</div>
<div class="line">      Property&lt;Visualization::ItemStyle&gt; condition{<span class="keyword">this</span>, <span class="stringliteral">&quot;condition&quot;</span>};</div>
<div class="line"></div>
<div class="line">      Property&lt;Visualization::VListStyle&gt; thenBranch{<span class="keyword">this</span>, <span class="stringliteral">&quot;thenBranch&quot;</span>};</div>
<div class="line">      Property&lt;Visualization::VListStyle&gt; elseBranch{<span class="keyword">this</span>, <span class="stringliteral">&quot;elseBranch&quot;</span>};</div>
<div class="line">      Property&lt;Visualization::VListStyle&gt; elseIfBranch{<span class="keyword">this</span>, <span class="stringliteral">&quot;elseIfBranch&quot;</span>};</div>
<div class="line"></div>
<div class="line">      Property&lt;Visualization::LineStyle&gt; elseHorizontalLine{<span class="keyword">this</span>, <span class="stringliteral">&quot;elseHorizontalLine&quot;</span>};</div>
<div class="line">      Property&lt;Visualization::LineStyle&gt; elseVerticalLine{<span class="keyword">this</span>, <span class="stringliteral">&quot;elseVerticalLine&quot;</span>};</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment --><p>There are three things to notice here:</p><ul>
<li>The style must ultimately inherit from <a class="el" href="classVisualization_1_1ItemStyle.html">Visualization::ItemStyle</a>. If your item inherits from <a class="el" href="classVisualization_1_1DeclarativeItem.html" title="The DeclarativeItem class is the base class for all items that use the declarative API for visualizat...">Visualization::DeclarativeItem</a> or another visual item that requires a more specific style, you must inherit from that item's style.</li>
<li>We always need to explicitly define the destructor. It must not be defined inline in the header file and should be defined only in the corresponding <code></code>.cpp file. Almost always the destructor will be empty and it will be the only thing we put in the <code></code>.cpp file. Nevertheless, this should still be done. The reason is that this is a hint to gcc, where to generate the virtual table for the class and other related data structures. If we don't do this, then this information will be generated in multiple plug-ins which will cause problems at run-time on Windows.</li>
<li>There is a list of properties that we want our style to include. Each property is defined by providing the type of information it should store. Additionally we need to provide <em>this</em> and a string to the property's constructor. The string is name of the tag in the XML file that will be used to read this property. By convention this should be the same as the name of the property.</li>
</ul>
<p>The corresponding <code></code>.cpp file is trivial and the same for most styles: </p><div class="fragment"><div class="line"><span class="comment">/***********************************************************************************************************************</span></div>
<div class="line"><span class="comment">**</span></div>
<div class="line"><span class="comment">** Copyright (c) 2011, 2014 ETH Zurich</span></div>
<div class="line"><span class="comment">** All rights reserved.</span></div>
<div class="line"><span class="comment">**</span></div>
<div class="line"><span class="comment">** Redistribution and use in source and binary forms, with or without modification, are permitted provided that the</span></div>
<div class="line"><span class="comment">** following conditions are met:</span></div>
<div class="line"><span class="comment">**</span></div>
<div class="line"><span class="comment">**    * Redistributions of source code must retain the above copyright notice, this list of conditions and the following</span></div>
<div class="line"><span class="comment">**      disclaimer.</span></div>
<div class="line"><span class="comment">**    * Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the</span></div>
<div class="line"><span class="comment">**      following disclaimer in the documentation and/or other materials provided with the distribution.</span></div>
<div class="line"><span class="comment">**    * Neither the name of the ETH Zurich nor the names of its contributors may be used to endorse or promote products</span></div>
<div class="line"><span class="comment">**      derived from this software without specific prior written permission.</span></div>
<div class="line"><span class="comment">**</span></div>
<div class="line"><span class="comment">**</span></div>
<div class="line"><span class="comment">** THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES,</span></div>
<div class="line"><span class="comment">** INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</span></div>
<div class="line"><span class="comment">** DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span></div>
<div class="line"><span class="comment">** SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR</span></div>
<div class="line"><span class="comment">** SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,</span></div>
<div class="line"><span class="comment">** WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span></div>
<div class="line"><span class="comment">** OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span></div>
<div class="line"><span class="comment">**</span></div>
<div class="line"><span class="comment">***********************************************************************************************************************/</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;VIfStatementStyle.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">namespace </span><a class="code" href="namespaceOOVisualization.html">OOVisualization</a> {</div>
<div class="line"></div>
<div class="line"><a class="code" href="classOOVisualization_1_1VIfStatementStyle.html#a2e1118f87a49d6efe11d6487ea321fc8">VIfStatementStyle::~VIfStatementStyle</a>(){}</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment --><p>And here is the corresponding default XML file <code></code>(OOVisualization/styles/item/VIfStatement/default). Things here can get a bit clunky, but the important thing to see is that each top-level tag corresponds to a property of the style or to a property of a base class. Simple properties like <code>cornerRadius</code> are represented by values. Properties which are themselves styles, follow an XML structure as dictated in their style class. To learn more about how styles work see the documentation of the <a class="el" href="namespaceVisualization.html" title="The VisualizationBase plug-in sets the foundations of the visualization framework in Envision...">Visualization</a> namespace.</p>
<div class="fragment"><div class="line">&lt;!DOCTYPE EnvisionVisualizationStyle&gt;</div>
<div class="line">&lt;style prototypes=&quot;item/DeclarativeItemBase/default&quot;&gt;</div>
<div class="line">   &lt;shape prototypes=&quot;shape/Box/default&quot;&gt;</div>
<div class="line">      Box</div>
<div class="line">      &lt;outline&gt;</div>
<div class="line">         &lt;width&gt;1&lt;/width&gt;</div>
<div class="line">         &lt;color&gt;#e0e0c8&lt;/color&gt;</div>
<div class="line">      &lt;/outline&gt;</div>
<div class="line">      &lt;backgroundBrush&gt;</div>
<div class="line">         &lt;style&gt;1&lt;/style&gt;</div>
<div class="line">         &lt;color&gt;#ffffe0&lt;/color&gt;</div>
<div class="line">      &lt;/backgroundBrush&gt;</div>
<div class="line">      &lt;cornerRadius&gt;2&lt;/cornerRadius&gt;</div>
<div class="line">   &lt;/shape&gt;</div>
<div class="line">   </div>
<div class="line">   &lt;header prototypes=&quot;layout/SequentialLayout/default&quot;&gt;</div>
<div class="line">      &lt;spaceBetweenElements&gt;5&lt;/spaceBetweenElements&gt;</div>
<div class="line">   &lt;/header&gt;</div>
<div class="line">   </div>
<div class="line">   &lt;icon prototypes=&quot;icon/SVGIcon/default&quot;&gt;</div>
<div class="line">      &lt;filename&gt;styles/icon/if.svg&lt;/filename&gt;</div>
<div class="line">      &lt;width&gt;22&lt;/width&gt;</div>
<div class="line">      &lt;height&gt;22&lt;/height&gt;</div>
<div class="line">      &lt;zValue&gt;1&lt;/zValue&gt;</div>
<div class="line">   &lt;/icon&gt;</div>
<div class="line">   </div>
<div class="line">   &lt;elseIcon prototypes=&quot;icon/SVGIcon/default&quot;&gt;</div>
<div class="line">      &lt;filename&gt;styles/icon/else.svg&lt;/filename&gt;</div>
<div class="line">      &lt;width&gt;22&lt;/width&gt;</div>
<div class="line">      &lt;height&gt;22&lt;/height&gt;</div>
<div class="line">      &lt;zValue&gt;1&lt;/zValue&gt;</div>
<div class="line">   &lt;/elseIcon&gt;</div>
<div class="line">   </div>
<div class="line">   &lt;elificon prototypes=&quot;icon/SVGIcon/default&quot;&gt;</div>
<div class="line">      &lt;filename&gt;styles/icon/if.svg&lt;/filename&gt;</div>
<div class="line">      &lt;width&gt;22&lt;/width&gt;</div>
<div class="line">      &lt;height&gt;22&lt;/height&gt;</div>
<div class="line">      &lt;zValue&gt;1&lt;/zValue&gt;</div>
<div class="line">   &lt;/elificon&gt;</div>
<div class="line">   </div>
<div class="line">   &lt;condition prototypes=&quot;item/Item/default&quot;&gt;</div>
<div class="line">      &lt;shape prototypes=&quot;shape/Frame/default&quot;&gt;</div>
<div class="line">         Frame</div>
<div class="line">         &lt;outline&gt;</div>
<div class="line">            &lt;width&gt;1&lt;/width&gt;</div>
<div class="line">            &lt;color&gt;#e0e0c8&lt;/color&gt;</div>
<div class="line">         &lt;/outline&gt;</div>
<div class="line">   </div>
<div class="line">         &lt;contentBrush&gt;</div>
<div class="line">            &lt;color&gt;#ffffe0&lt;/color&gt;</div>
<div class="line">         &lt;/contentBrush&gt;</div>
<div class="line">         </div>
<div class="line">         &lt;topBrush&gt;</div>
<div class="line">            &lt;style&gt;1&lt;/style&gt;</div>
<div class="line">            &lt;color&gt;#e0e0c8&lt;/color&gt;</div>
<div class="line">         &lt;/topBrush&gt;</div>
<div class="line">         &lt;topWidth&gt;1&lt;/topWidth&gt;</div>
<div class="line">         &lt;topMargin&gt;1&lt;/topMargin&gt;</div>
<div class="line">         </div>
<div class="line">         &lt;bottomBrush&gt;</div>
<div class="line">            &lt;style&gt;1&lt;/style&gt;</div>
<div class="line">            &lt;color&gt;#e0e0c8&lt;/color&gt;</div>
<div class="line">         &lt;/bottomBrush&gt;</div>
<div class="line">         &lt;bottomWidth&gt;1&lt;/bottomWidth&gt;</div>
<div class="line">         &lt;bottomMargin&gt;1&lt;/bottomMargin&gt;</div>
<div class="line">         </div>
<div class="line">         &lt;leftBrush&gt;</div>
<div class="line">            &lt;style&gt;1&lt;/style&gt;</div>
<div class="line">            &lt;color&gt;#e0e0c8&lt;/color&gt;</div>
<div class="line">         &lt;/leftBrush&gt;</div>
<div class="line">         &lt;leftWidth&gt;1&lt;/leftWidth&gt;</div>
<div class="line">         &lt;leftMargin&gt;15&lt;/leftMargin&gt;</div>
<div class="line">         </div>
<div class="line">         &lt;rightBrush&gt;</div>
<div class="line">            &lt;style&gt;1&lt;/style&gt;</div>
<div class="line">            &lt;color&gt;#e0e0c8&lt;/color&gt;</div>
<div class="line">         &lt;/rightBrush&gt;</div>
<div class="line">         &lt;rightWidth&gt;1&lt;/rightWidth&gt;</div>
<div class="line">         &lt;rightMargin&gt;1&lt;/rightMargin&gt;</div>
<div class="line">      &lt;/shape&gt;</div>
<div class="line">   &lt;/condition&gt;</div>
<div class="line">   </div>
<div class="line">   &lt;thenBranch prototypes=&quot;item/VStatementItemList/default&quot; /&gt;</div>
<div class="line">   &lt;elseBranch prototypes=&quot;item/VStatementItemList/default&quot; /&gt;</div>
<div class="line">   &lt;elseIfBranch prototypes=&quot;item/VStatementItemList/default&quot; /&gt;</div>
<div class="line">   </div>
<div class="line">   &lt;elseHorizontalLine prototypes=&quot;item/Line/default&quot;&gt;</div>
<div class="line">      &lt;pen&gt;</div>
<div class="line">         &lt;color&gt;#e0e0c8&lt;/color&gt;</div>
<div class="line">      &lt;/pen&gt;</div>
<div class="line">   &lt;/elseHorizontalLine&gt;</div>
<div class="line">   </div>
<div class="line">   &lt;elseVerticalLine prototypes=&quot;item/Line/default&quot;&gt;</div>
<div class="line">      &lt;width&gt;1&lt;/width&gt;</div>
<div class="line">      &lt;height&gt;0&lt;/height&gt;</div>
<div class="line">      &lt;pen&gt;</div>
<div class="line">         &lt;color&gt;#e0e0c8&lt;/color&gt;</div>
<div class="line">      &lt;/pen&gt;</div>
<div class="line">   &lt;/elseVerticalLine&gt;</div>
<div class="line">&lt;/style&gt;</div>
</div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
